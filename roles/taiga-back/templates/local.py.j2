from .common import *

{% set scheme = 'https' if (taiga_enable_ssl | bool) else 'http' %}

MEDIA_URL = "{{ scheme }}://{{ taiga_frontend_host }}/media/"
STATIC_URL = "{{ scheme }}://{{ taiga_frontend_host }}/static/"
SITES["front"]["scheme"] = "{{ scheme }}"
SITES["front"]["domain"] = "{{ taiga_frontend_host }}"

SECRET_KEY = "{{ taiga_secret_key }}"

DATABASES = {
    "default": {
        "ENGINE": "django.db.backends.postgresql",
        "NAME": "{{ taiga_back_database_name }}",
        "USER": "{{ taiga_back_database_user }}",
    }
}

DEBUG = {{ taiga_debug | bool }}
PUBLIC_REGISTER_ENABLED = {{ taiga_enable_public_register | bool }}

DEFAULT_FROM_EMAIL = "{{ taiga_back_default_from_email }}"
SERVER_EMAIL = DEFAULT_FROM_EMAIL

CELERY_ENABLED = {{ taiga_enable_async_tasks | bool }}

{% if taiga_enable_events | bool %}
EVENTS_PUSH_BACKEND = "taiga.events.backends.rabbitmq.EventsPushBackend"
EVENTS_PUSH_BACKEND_OPTIONS = {"url": "amqp://{{ taiga_rabbitmq_user }}:{{ taiga_rabbitmq_password }}@{{ taiga_rabbitmq_host }}:{{ taiga_rabbitmq_port }}/{{ taiga_rabbitmq_vhost }}"}
{% endif %}

{% if taiga_enable_email | bool %}
# Uncomment and populate with proper connection parameters
# for enable email sending. EMAIL_HOST_USER should end by @domain.tld
EMAIL_BACKEND = "django.core.mail.backends.smtp.EmailBackend"
EMAIL_USE_TLS = {{ taiga_email_use_tls | bool }}
EMAIL_HOST = "{{ taiga_email_host }}"
EMAIL_HOST_USER = "{{ taiga_email_host_user }}"
EMAIL_HOST_PASSWORD = "{{ taiga_email_host_password }}"
EMAIL_PORT = {{ taiga_email_port }}
{% endif %}

{% if taiga_enable_github_login | bool %}
GITHUB_API_CLIENT_ID = "{{ taiga_github_api_client_id }}"
GITHUB_API_CLIENT_SECRET = "{{ taiga_github_api_client_secret }}"
{% endif %}

{% if taiga_enable_ldap_login | bool %}
INSTALLED_APPS += ["taiga_contrib_ldap_auth"]

LDAP_SERVER = '{{ taiga_ldap_server }}'
LDAP_PORT = {{ taiga_ldap_port }}

{% if taiga_ldap_bind_dn %}
LDAP_BIND_DN = '{{ taiga_ldap_bind_dn }}'
LDAP_BIND_PASSWORD = ''{{ taiga_ldap_bind_password }}'
{% endif %}

LDAP_SEARCH_BASE = '{{ taiga_ldap_search_base }}'

LDAP_SEARCH_PROPERTY = '{{ taiga_ldap_search_property }}'
LDAP_SEARCH_SUFFIX = '{{ taiga_ldap_search_suffix }}'

LDAP_EMAIL_PROPERTY = '{{ taiga_ldap_email_property }}'
LDAP_FULL_NAME_PROPERTY = '{{ taiga_ldap_full_name_property }}'
{% endif %}
